@if (loading) {
<div [@modalState]="animationState" class="fixed inset-0 bg-slate-800/70 z-50 flex items-center justify-center">
  <div [@modalContent]="animationState" class="bg-white rounded-3xl shadow-xl max-w-[700px] w-full max-h-[90vh] overflow-y-auto relative">
    <div class="flex flex-col items-center justify-center py-10">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-opacity-50 mb-4"></div>
      <p class="text-center text-gray-500 text-lg">Cargando producto...</p>
    </div>
    <button class="absolute top-4 right-4 bg-transparent border-none text-2xl text-slate-400 cursor-pointer hover:text-slate-800 transition-colors z-10" (click)="onCloseClick()">&times;</button>
  </div>
</div>
} @else if (error) {
<div [@modalState]="animationState" class="fixed inset-0 bg-slate-800/70 z-50 flex items-center justify-center">
  <div [@modalContent]="animationState" class="bg-white rounded-3xl shadow-xl max-w-[700px] w-full max-h-[90vh] overflow-y-auto relative">
    <div class="flex flex-col items-center justify-center py-10">
      <div class="text-6xl mb-4">❌</div>
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Producto no encontrado</h2>
      <p class="text-gray-600 mb-6">El producto que buscas no existe o ha sido eliminado.</p>
      <button (click)="onCloseClick()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">Volver al catálogo</button>
    </div>
    <button class="absolute top-4 right-4 bg-transparent border-none text-2xl text-slate-400 cursor-pointer hover:text-slate-800 transition-colors z-10" (click)="onCloseClick()">&times;</button>
  </div>
</div>
} @else if (product) {
<div [@modalState]="animationState" class="fixed inset-0 bg-slate-800/70 z-50 flex items-center justify-center">
  <div [@modalContent]="animationState" class="bg-white rounded-xl  max-w-[90vw] w-full max-h-[90vh] overflow-y-auto relative">
    <div class="container mx-auto p-6">
      <div class="mb-6 text-right">
        <!-- <button (click)="onCloseClick()" class="flex items-center text-blue-600 hover:text-blue-800 transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Cerrar
        </button> -->
      </div>
      <div class="bg-white overflow-hidden">
        <div class="grid md:grid-cols-2 gap-8 p-6">
          <div class="space-y-4">
            <div class="aspect-square bg-gray-100 rounded-xl overflow-hidden relative border border-gray-100">
              <img ngOptimizedImage
                [ngSrc]="selectedImage() ? selectedImage()! : 'https://picsum.photos/600/600'"
                fill alt="{{ product.nombre }}" class="object-cover transition-all duration-500"
                priority />
            </div>

            <!-- Miniaturas -->
            @if (product.imagenes && product.imagenes.length > 1) {
              <div class="grid grid-cols-4 gap-2 mt-4">
                @for (img of product.imagenes; track img) {
                  <div 
                    (click)="selectImage(img)"
                    class="aspect-square rounded-lg overflow-hidden cursor-pointer border-2 transition-all duration-300"
                    [class.border-brand-pink]="selectedImage() === img"
                    [class.border-transparent]="selectedImage() !== img"
                    [class.shadow-sm]="selectedImage() === img"
                    [class.opacity-60]="selectedImage() !== img"
                    [class.hover:opacity-100]="selectedImage() !== img">
                    <img [src]="img" class="w-full h-full object-cover" [alt]="product.nombre" loading="lazy">
                  </div>
                }
              </div>
            }
          </div>
          <div class="flex flex-col">
            <div>
              <h1 class="text-xl font-bold text-gray-900 mb-4">{{ product.nombre }}</h1>
              <div class="mb-8">
                @if (product.descuento && product.descuento > 0) {
                  <div class="flex items-center gap-3">
                    <p class="text-3xl font-extrabold text-red-600">
                      $ {{ (product.precio * (1 - product.descuento / 100)).toFixed(2) }}
                    </p>
                    <div class="flex flex-col">
                      <span class="text-sm text-gray-400 line-through">
                        $ {{ product.precio }}
                      </span>
                      <span class="bg-red-100 text-red-600 text-[10px] font-bold px-2 py-0.5 rounded-full">
                        {{ product.descuento }}% OFF
                      </span>
                    </div>
                  </div>
                } @else {
                  <p class="text-3xl font-extrabold text-red-600">
                    $ {{ product.precio }}
                  </p>
                }
              </div>
              <div class="mb-8">
                <h3 class="text-xs uppercase text-brand-gray-dark mb-2">Descripción</h3>
                <p class="text-gray-700 text-sm leading-tight">{{ product.descripcion }}</p>
              </div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                <!-- <div class="bg-gray-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-gray-800 mb-1">ID del Producto</h4>
                  <p class="text-gray-600 text-sm">{{ product.id }}</p>
                </div> -->
                <div class="">
                  <h4 class="text-xs uppercase font-ftn-light text-brand-gray-dark mb-1">Disponibilidad</h4>
                  @if (product.disponibilidad) {
                    <p class="text-brand-pink-dark font-ftn-bold bg-brand-pink/10 inline-block px-4 py-1">
                      Con stock
                    </p>
                  } @else {
                    <p class="text-red-500 font-ftn-bold bg-red-100 inline-block px-4 py-1">
                      Sin stock
                    </p>
                  }
                </div>
              </div>
              <div class="bg-brand-gray/20 px-4 py-6">
                <h4 class="text-sm font-ftn-medium mb-2 flex items-center">

                  <svg viewBox="0 0 20 20" focusable="false" class="w-4 h-4 mr-3"><path d="M13.2238 4.9337C13.1504 1.68636 9.32745 -0.0329918 6.56564 1.94201C3.42904 4.18502 3.42047 8.70116 5.85008 11.9883L10.4891 18.2647C12.0567 16.4701 14.5046 12.9513 15.7745 10.3471C16.5453 8.76617 16.9721 7.00668 16.5525 5.43291C16.4586 5.08077 16.3151 4.73487 16.1039 4.4181L17.0303 3.80052C17.3202 4.23531 17.5086 4.69733 17.6283 5.14605C18.1468 7.09056 17.6002 9.14313 16.7752 10.8351C15.3297 13.7995 12.4381 17.8735 10.8443 19.5261L10.3873 20L4.95474 12.6501C2.3006 9.05915 2.09757 3.76842 5.91802 1.03638C9.28618 -1.37222 14.24 0.621738 14.3369 4.90856C14.3392 5.01323 14.3404 5.11795 14.3404 5.22267C14.3404 7.6345 12.809 9.67611 10.722 9.67611C10.6154 9.67611 10.5052 9.66845 10.394 9.65515C8.64738 9.44629 7.59034 8.12336 7.39053 6.72797C7.18968 5.32541 7.85018 3.79067 9.53285 3.20839C9.91859 3.07491 10.3204 2.99595 10.722 2.99595V4.10931C10.4653 4.10931 10.1872 4.1601 9.89694 4.26053C8.78915 4.64388 8.35627 5.61781 8.49264 6.57015C8.63005 7.52968 9.34083 8.40792 10.5262 8.54966C10.6024 8.55878 10.6677 8.56275 10.722 8.56275C11.9751 8.56275 13.227 7.26428 13.227 5.22267C13.227 5.12633 13.226 5.02998 13.2238 4.9337Z" fill="currentColor"></path></svg>
                  <span>
                  Recoger en tienda
                  </span>
                </h4>
                <p class="text-sm pl-7">
                  Comunicate con nosotros para coordinar la recogida de tu pedido en nuestra tienda física. Estamos ubicados en el corazón de la ciudad, listos para atenderte con una sonrisa y ayudarte a llevar tus joyas favoritas a casa. ¡Te esperamos!
                </p>

              </div>
            </div>
            <div class="space-y-2 mt-10">
              <button (click)="contactWhatsApp()"
                class="w-auto text-sm bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2 cursor-pointer">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488" />
                </svg>
                <span>Consultanos por WhatsApp</span>
              </button>
              <!-- <p class="text-center text-gray-500 text-sm">
                Te contactaremos para ayudarte con tu consulta
              </p> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <button class="absolute top-4 right-4 bg-transparent border-none text-2xl text-slate-400 cursor-pointer hover:text-slate-800 transition-colors z-10" (click)="onCloseClick()">&times;</button>
  </div>
</div>
}
